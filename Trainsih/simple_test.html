<!DOCTYPE html>
<html>
<head>
    <title>Train AI Test</title>
</head>
<body>
    <h1>Train Control AI Test</h1>
    
    <div>
        <h3>Train 1</h3>
        <input id="train1_id" placeholder="Train ID" value="EXP-001">
        <input id="train1_source" placeholder="Source" value="Mumbai Central">
        <input id="train1_dest" placeholder="Destination" value="New Delhi">
        <select id="train1_priority">
            <option value="High">High</option>
            <option value="Medium">Medium</option>
            <option value="Low">Low</option>
        </select>
    </div>
    
    <div>
        <h3>Train 2</h3>
        <input id="train2_id" placeholder="Train ID" value="LOCAL-002">
        <input id="train2_source" placeholder="Source" value="Mumbai Central">
        <input id="train2_dest" placeholder="Destination" value="New Delhi">
        <select id="train2_priority">
            <option value="High">High</option>
            <option value="Medium" selected>Medium</option>
            <option value="Low">Low</option>
        </select>
    </div>
    
    <button onclick="runAI()">Run AI Analysis</button>
    
    <div id="output" style="margin-top: 20px; padding: 10px; background: #f0f0f0;"></div>

    <script>
        async function runAI() {
            const scenario = {
                "trains": [
                    {
                        "train_id": document.getElementById('train1_id').value,
                        "name": "Train 1",
                        "train_type": "passenger",
                        "priority_level": document.getElementById('train1_priority').value,
                        "speed_kmph": 80,
                        "length_m": 200,
                        "sched_departure": "08:00",
                        "sched_arrival": "12:00",
                        "source": document.getElementById('train1_source').value,
                        "destination": document.getElementById('train1_dest').value,
                        "route_path": [document.getElementById('train1_source').value, document.getElementById('train1_dest').value]
                    },
                    {
                        "train_id": document.getElementById('train2_id').value,
                        "name": "Train 2",
                        "train_type": "passenger",
                        "priority_level": document.getElementById('train2_priority').value,
                        "speed_kmph": 60,
                        "length_m": 150,
                        "sched_departure": "08:15",
                        "sched_arrival": "13:00",
                        "source": document.getElementById('train2_source').value,
                        "destination": document.getElementById('train2_dest').value,
                        "route_path": [document.getElementById('train2_source').value, document.getElementById('train2_dest').value]
                    }
                ],
                "sections": [
                    {"from_node": document.getElementById('train1_source').value, "to_node": document.getElementById('train1_dest').value, "travel_time_min": 240.0, "availability": "single", "section_capacity": 1, "signalling": "Automatic Block"}
                ],
                "stations": [
                    {"station_id": document.getElementById('train1_source').value, "platform_count": 4, "platform_length_m": 400, "halt_time_min": 2.0, "station_priority": "major_junction"},
                    {"station_id": document.getElementById('train1_dest').value, "platform_count": 4, "platform_length_m": 400, "halt_time_min": 2.0, "station_priority": "major_junction"}
                ],
                "constraints": {
                    "min_headway_min": 2.0,
                    "allow_overtake": true,
                    "crossing_rule": "passenger_first",
                    "track_conflict_rule": "single_line_opposite_forbidden"
                },
                "simulation": {
                    "simulation_speed": "realtime",
                    "num_trains": 2,
                    "scenario_type": "normal",
                    "optimization_goal": "prioritize_passenger"
                }
            };

            try {
                console.log('Sending to backend:', scenario);
                
                const response = await fetch('http://localhost:5000/analyze_scenario', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(scenario),
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Backend response:', data);
                
                document.getElementById('output').innerHTML = `
                    <h3>AI Analysis Result:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('output').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>